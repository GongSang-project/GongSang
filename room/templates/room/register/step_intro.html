{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>방 등록 - 9. 집 소개</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="{% static 'users/css/survey_form.css' %}">
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

    :root{
      --orange:#F26430; --black:#121212; --grey:#515151;
      --page-w:375px; --bd:#E9E9E9;
    }

    *{box-sizing:border-box}
    body{margin:0;background:#000;font-family:'Pretendard',system-ui,-apple-system,'Segoe UI',Roboto,'Noto Sans KR',sans-serif}

    #root{width:var(--page-w);height:812px;margin:0 auto;background:#fff;position:relative;overflow:hidden}
    #app-wrapper{
      width:100%;height:100%;overflow:auto;position:relative;transform:translateZ(0);
      -ms-overflow-style:none; scrollbar-width:none;
    }
    #app-wrapper::-webkit-scrollbar{display:none}

    /* 헤더 */
    .header{position:sticky;top:0;height:102.94px;background:#fff;z-index:100}
    .back-btn{appearance:none;background:none;border:0;cursor:pointer;position:absolute;left:20.6133px;top:54px}
    .back-btn img{width:20px;height:27px;padding:6px}
    .title{position:absolute;top:60px;left:143px;margin:0;color:var(--black);font-size:20px;font-weight:500;line-height:15px;white-space:nowrap}

    /* 상단 텍스트(고정) */
    .num{position:sticky; top:102.94px; margin:0; padding:24px 0 0 24px; background:#fff; color:var(--grey); font-size:15px; font-weight:500; z-index:5}
    .qu-wrap{position:sticky; top:126px; background:#fff; padding:6px 25px 10px 25px; z-index:5}
    .qu{margin:0; color:var(--black); font-size:25px; font-weight:600; line-height:32px}

    /* 본문 */
    form#introForm{padding:8px 25px 120px}
    .textarea{
      width:100%; height:180px; resize:none;
      padding:12px 14px; border:1px solid var(--bd); border-radius:12px;
      font-size:16px; line-height:1.4; outline:none;
    }
    .textarea::placeholder{color:#9a9a9a}

    /* 하단 고정 버튼 */
    .footer{position:sticky; bottom:0; z-index:90; background:linear-gradient(#fff 70%, rgba(255,255,255,0)); padding:12px 16px 16px}
    .btn-primary{
      width:343px; height:56px; border:none; border-radius:10px; background:var(--orange);
      color:#fff; font-size:20px; font-weight:700; display:block; margin:0 auto; cursor:pointer;
    }
    .btn-primary:disabled{opacity:.5; cursor:not-allowed}

    /* 완료 화면(오버레이, 헤더 고정 영향 X) */
    #doneSection{
      position:absolute; left:0; right:0; top:102.94px; bottom:0; /* 헤더 아래부터 덮기 */
      background:#fff; display:none; /* JS로 토글 */
      padding:60px 25px 16px; text-align:center;
    }
    #doneSection h2{margin:0 0 20px; font-size:22px; color:#121212}
    .checkmark{width:120px; height:120px; object-fit:contain; margin:24px auto 28px; display:block}
    .cta{
      width:343px; height:56px; border:none; border-radius:10px; background:var(--orange);
      color:#fff; font-size:20px; font-weight:700; display:block; margin:0 auto; cursor:pointer;
    }

    .visually-hidden{
      position:absolute !important; width:1px; height:1px; margin:-1px; padding:0; border:0;
      clip:rect(0 0 1px 1px); clip-path:inset(50%); overflow:hidden;
    }
  </style>
</head>
<body>
  <div id="root">
    <div id="app-wrapper">

      <!-- 헤더 -->
      <div class="header">
        <button type="button" class="back-btn" aria-label="이전">
          <img src="{% static 'users/images/Vector.png' %}" alt="">
        </button>
        <h1 class="title">방 등록하기</h1>
      </div>

      <!-- 상단 텍스트 -->
      <p class="num">{{ step|default:"9/9" }}</p>
      <div class="qu-wrap"><h2 class="qu">집에 대해 이야기해주세요</h2></div>

      <!-- 폼 -->
      <form id="introForm" method="post" novalidate>
        {% csrf_token %}
        <textarea id="intro" name="intro" class="textarea"
          placeholder="예시)\n햇빛이 잘 들어서 아침마다 방이 환하고 따뜻해요.\n조용한 동네라 공부나 휴식하기 좋아요."></textarea>
      </form>

      <!-- 하단 고정: 등록 완료(미리보기) -->
      <div class="footer">
        <button type="button" id="btnPreview" class="btn-primary">등록 완료</button>
      </div>

      <!-- 완료 화면 -->
      <section id="doneSection" aria-hidden="true">
        <button type="button" class="backBtn" id="doneBack" aria-label="이전"
                style="position:absolute;left:20.6px;top:20px;background:none;border:0;">
          <img src="{% static 'users/images/Vector.png' %}" alt="" class="icon" style="width:20px;height:27px;padding:6px;">
        </button>
        <h2>방 등록이 완료되었어요!</h2>
        <img src="{% static 'users/images/check-circle.png' %}" alt="" class="checkmark">
        <button type="button" class="cta" id="goMyRooms">등록한 방 보기</button>
      </section>

    </div>
  </div>

  <script>
    // 상단 뒤로가기
    document.querySelector('.back-btn').addEventListener('click', ()=>{
      if (history.length > 1) history.back();
      else if (document.referrer) location.href = document.referrer;
      else location.href = '/';
    });

    // 1) '등록 완료' → 완료 화면만 띄우기(서버 제출 X)
    const previewBtn = document.getElementById('btnPreview');
    const doneSec    = document.getElementById('doneSection');
    const introForm  = document.getElementById('introForm');
    previewBtn.addEventListener('click', ()=>{
      // 필요하면 간단한 빈값 체크
      // if (!document.getElementById('intro').value.trim()) return alert('내용을 입력해 주세요.');
      doneSec.style.display = 'block';     // overlay on
      doneSec.setAttribute('aria-hidden','false');
    });

    // 2) 완료 화면의 '등록한 방 보기' → 실제 제출(백엔드 동작 시점)
    document.getElementById('goMyRooms').addEventListener('click', ()=>{
      introForm.submit();
    });

    // 3) 완료 화면의 뒤로가기 → 완료 화면 닫고 폼으로 복귀
    document.getElementById('doneBack').addEventListener('click', ()=>{
      doneSec.style.display = 'none';
      doneSec.setAttribute('aria-hidden','true');
    });
  </script>
</body>
</html>
