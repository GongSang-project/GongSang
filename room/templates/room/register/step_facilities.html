<h1 style="font-size:20px;margin:16px 0 8px;">방 등록하기</h1>
<p style="color:#777;margin:0 0 16px;">{{ step }}</p>

<form method="post" id="facilitiesForm">
  {% csrf_token %}

  <section id="part1">
    <h2 style="font-size:22px;margin:0 0 12px;">제공되는 것들을 선택해주세요</h2>

    <h3 style="margin:14px 0 8px;">생활시설</h3>
    <div class="chips">
      {% for key,label in option_choices %}
        {# 입력은 시각적으로만 숨기고 라벨로 토글 #}
        <input type="checkbox" class="chip-input visually-hidden"
               id="opt-{{ key }}" name="options" value="{{ key }}"
               {% if key in initial_options %}checked{% endif %}>
        <label for="opt-{{ key }}" class="chip {% if key in initial_options %}on{% endif %}">{{ label }}</label>
      {% endfor %}
    </div>

    <h3 style="margin:18px 0 8px;">보안시설</h3>
    <div class="chips">
      {% for key,label in security_choices %}
        <input type="checkbox" class="chip-input visually-hidden"
               id="sec-{{ key }}" name="security_facilities" value="{{ key }}"
               {% if key in initial_security %}checked{% endif %}>
        <label for="sec-{{ key }}" class="chip {% if key in initial_security %}on{% endif %}">{{ label }}</label>
      {% endfor %}
    </div>
  </section>

  <section id="part2" style="margin-top:18px;">
    <h3 style="margin:18px 0 8px;">기타시설</h3>
    <div class="chips">
      {% for key,label in other_choices %}
        <input type="checkbox" class="chip-input visually-hidden"
               id="oth-{{ key }}" name="other_facilities" value="{{ key }}"
               {% if key in initial_other %}checked{% endif %}>
        <label for="oth-{{ key }}" class="chip {% if key in initial_other %}on{% endif %}">{{ label }}</label>
      {% endfor %}
    </div>

    <h3 style="margin:18px 0 8px;">주차</h3>
    <div class="radios">
      <label><input type="radio" name="parking_available" value="true"  {% if initial_parking %}checked{% endif %}> 가능</label>
      <label><input type="radio" name="parking_available" value="false" {% if not initial_parking %}checked{% endif %}> 불가능</label>
    </div>

    <h3 style="margin:18px 0 8px;">반려동물</h3>
    <div class="radios">
      <label><input type="radio" name="pet_allowed" value="true"  {% if initial_pet %}checked{% endif %}> 있음</label>
      <label><input type="radio" name="pet_allowed" value="false" {% if not initial_pet %}checked{% endif %}> 없음</label>
    </div>

    <h3 style="margin:18px 0 8px;">난방 방식</h3>
    <div class="radios">
      {% for key,label in heating_choices %}
        <label><input type="radio" name="heating_type" value="{{ key }}" {% if key == initial_heating %}checked{% endif %}> {{ label }}</label>
      {% endfor %}
    </div>

    <button type="submit" class="submit">등록 완료</button>
  </section>
</form>

<style>
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid #ddd;border-radius:999px;padding:8px 12px;cursor:pointer;user-select:none}
  .chip.on{background:#ffede6;border-color:#ffb99f;color:#d8572a}
  .radios{display:flex;gap:18px;align-items:center}
  .submit{width:100%;margin:24px 0 8px;padding:14px 16px;border:none;border-radius:14px;background:#f0642d;color:#fff;font-size:16px}
  /* 핵심: 포커스/클릭은 살려두고 화면엔 안 보이게 */
  .visually-hidden{
    position:absolute !important;
    width:1px; height:1px; margin:-1px; padding:0; border:0;
    clip:rect(0 0 1px 1px); clip-path:inset(50%); overflow:hidden;
  }
</style>

<script>
  // input 상태와 chip 라벨의 .on 클래스를 동기화
  document.querySelectorAll('.chip-input').forEach(inp => {
    const lab = document.querySelector(`label[for="${inp.id}"]`);
    const sync = ()=> lab.classList.toggle('on', inp.checked);
    inp.addEventListener('change', sync);
    // 라벨 클릭 시에도 브라우저가 자동으로 inp.checked 토글 → change 발생 → sync
    sync(); // 초기 상태 반영
  });
</script>
