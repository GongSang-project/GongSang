{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>등록한 방</title>
  <meta name="viewport" content="width=375, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
  <style>
    :root{
      --app-w:375px;
      --bg:#f3f3f3;
      --white:#ffffff;
      --line:#e8e8e8;
      --text:#121212;
      --muted:#959595;
      --orange:#f26430;
      --peach:#ffebd9;
      --shadow:0 0 10px #0000001a;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--text);
         font-family:Pretendard,-apple-system,system-ui,Segoe UI,Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif}
    a{color:inherit; text-decoration:none}

    .screen{width:var(--app-w); min-height:812px; margin:0 auto; background:var(--bg);}

    /* ===== 헤더 ===== */
    .header{
      position:sticky; top:0; z-index:10;
      height:80px; background:#fff; border-bottom:1px solid var(--line);
      border-radius:0 0 12px 12px; box-shadow:var(--shadow);
    }
    .header-inner{position:relative; height:100%;}
    .title{position:absolute; left:0; right:0; top:44px; text-align:center;
      font-weight:600; font-size:20px;}
    .back{position:absolute; left:16px; top:44px; width:28px; height:28px;
      display:grid; place-items:center; cursor:pointer; border-radius:8px; background:transparent; border:none;}
    .back svg{width:10px; height:17px}

    /* ===== 리스트 영역 ===== */
    .wrap{padding:18px 14px 40px;}

    .card{
      position:relative;
      display:flex; gap:14px; align-items:flex-start;
      background:#fff; border:1px solid #ededed; border-radius:12px;
      box-shadow:var(--shadow);
      padding:12px; margin-bottom:14px;
    }
    .thumb{position:relative; width:135px; height:173px; border-radius:10px; overflow:hidden; background:#d1d1d1; flex:0 0 135px;}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .dots{position:absolute; left:0; right:0; bottom:8px; display:flex; justify-content:center; gap:4px;}
    .dot{width:5px; height:5px; border-radius:50%; background:rgba(255,255,255,.55)}
    .dot.active{background:#fff}

    .meta{flex:1; min-width:0; display:flex; flex-direction:column; }
    .room-title{font-weight:700; font-size:16px; line-height:1.25; margin:4px 0 6px; word-break:keep-all}
    .price{color:#333; font-size:15px; margin-bottom:12px}
    .dates{font-size:12px; line-height:1.45; display:flex; flex-direction:column; gap:4px; margin-top:4px}
    .dates .row{display:flex; justify-content:space-between; align-items:center;}
    .dates .label{color:var(--muted)}
    .dates .val{color:var(--muted); white-space:nowrap}

    .actions{margin-top:30px; display:flex; gap:10px}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:6px;
         width:128px; padding:10px; border-radius:9px; font-weight:700; border:0; cursor:pointer}
    .btn.edit{background:var(--peach); color:var(--orange)}
    .btn.del{background:var(--orange); color:#fff}

    /* 상태 뱃지(모집중/계약중) */
    .badge{
      position:absolute; right:16px; top:12px;
      display:inline-flex; align-items:center; justify-content:center;
      height:20px; padding:0 10px; border-radius:10px; background:#ececec; color:#8c8c8c;
      font-size:11px; font-weight:500;
    }

    /* 모달(삭제 확인) */
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50; padding:18px;}
    .modal.show{display:flex;}
    .dialog{width:100%; max-width:340px; border-radius:18px; background:#fff; padding:22px 18px 18px; box-shadow:0 16px 40px rgba(0,0,0,.25); text-align:center}
    .dialog h3{margin:8px 0 8px; font-size:20px; font-weight:800; line-height:1.3}
    .dialog p{margin:0 0 18px; color:#6b7280; font-size:14px; line-height:1.6; white-space:pre-line}
    .dialog .row{display:flex; gap:12px; justify-content:center; margin-top:8px}
    .btn.light{background:#f3f4f6; color:#4b5563; border:1px solid #e5e7eb; font-weight:700; border-radius:10px; padding:10px 16px}
    .dlg-icon{display:block; margin:2px auto 8px}
    .dlg-icon svg{width:28px; height:28px}
  </style>
</head>
<body>
<div class="screen">

  <!-- ===== 헤더 ===== -->
  <header class="header">
    <div class="header-inner">
      <button class="back" type="button" aria-label="뒤로가기" onclick="history.back()">
        <!-- 얇은 뒤로가기 -->
        <svg viewBox="0 0 10 17" xmlns="http://www.w3.org/2000/svg" fill="none">
          <path d="M8.5 1 1.5 8.5 8.5 16" stroke="#121212" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div class="title">등록한 방</div>
    </div>
  </header>

  <!-- ===== 리스트 ===== -->
  <div class="wrap">
    {% if rooms %}
      {% for room in rooms %}
        {% with photos=room.room_photos.all %}
        <article class="card" data-room-id="{{ room.id }}">
          <!-- 썸네일 -->
          <a href="{% url 'room:room_detail' room.id %}" class="thumb" aria-label="방 상세 보기">
            {% if photos|length %}
              <img src="{{ photos.0.image.url }}" alt="">
            {% endif %}
            <div class="dots">
              {% for p in photos|slice:":5" %}
                <span class="dot {% if forloop.first %}active{% endif %}"></span>
              {% empty %}
                <span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
              {% endfor %}
            </div>
          </a>

          <!-- 내용 -->
          <div class="meta">
            <span class="badge">{% if room.contracted_youth %}계약중{% else %}모집중{% endif %}</span>

            <div class="room-title">
              {% if room.address_detailed %}{{ room.address_detailed }}{% else %}
                {{ room.address_city }} {{ room.address_district }}
              {% endif %}
            </div>

            <div class="price">월세 {{ room.deposit|default:"-" }}/{{ room.rent_fee|default:"-" }}</div>

            <div class="dates">
              <div class="row">
                <span class="label">등록일</span>
                <span class="val">{{ room.created_at|date:"Y.m.d" }}</span>
              </div>
              <div class="row">
                <span class="label">최근 수정일</span>
                <span class="val">{{ room.updated_at|date:"Y.m.d" }}</span>
              </div>
            </div>

            <div class="actions">
              <a class="btn edit" href="{% url 'room:owner_room_update' room.id %}">수정</a>
              <button class="btn del delete-btn" type="button" data-action="{% url 'room:owner_room_delete' room.id %}">삭제</button>
            </div>
          </div>
        </article>
        {% endwith %}
      {% endfor %}
    {% else %}
      <p style="color:#666; text-align:center; margin-top:40px;">아직 등록한 방이 없어요. 새로 등록해보세요.</p>
    {% endif %}
  </div>

  <!-- 삭제 모달 -->
  <div id="deleteModal" class="modal" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dlg-title">
      <div class="dlg-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none">
          <path d="M12 3.5 1.9 20.5a1 1 0 0 0 .85 1.5h18.5a1 1 0 0 0 .85-1.5L12 3.5z" fill="var(--orange)"/>
          <rect x="11" y="8" width="2" height="7" rx="1" fill="#fff"/>
          <rect x="11" y="16.5" width="2" height="2" rx="1" fill="#fff"/>
        </svg>
      </div>
      <h3 id="dlg-title">정말 삭제하시겠어요?</h3>
      <p>삭제하면 해당 방 정보와
모든 관련 데이터가 사라집니다.
이 작업은 되돌릴 수 없습니다.</p>
      <form id="deleteForm" method="post" action="">
        {% csrf_token %}
        <div class="row">
          <button type="button" class="btn light" id="cancelDelete">취소</button>
          <button type="submit" class="btn del">삭제</button>
        </div>
      </form>
    </div>
  </div>

</div>

<script>
  // 삭제 모달 동작
  (function(){
    const modal = document.getElementById('deleteModal');
    const form  = document.getElementById('deleteForm');
    const cancelBtn = document.getElementById('cancelDelete');

    function openModal(url){ form.action = url; modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
    function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

    document.querySelectorAll('.delete-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> openModal(btn.dataset.action));
    });
    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeModal(); });
  })();
</script>
</body>
</html>
