{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ owner.username }}님의 프로필</title>
  <link rel="stylesheet" href="{% static 'users/css/senior_profile.css' %}?v=9" />
</head>
<body>
  <div id="root">
    <div id="app-wrapper">

      <div class="header">
        <a href="http://localhost:8000/room/detail/1/">
          <img src="{% static 'users/images/Vector.png' %}" alt="" class="icon">
        </a>
        <h1>성향 매칭 분석 결과</h1>
      </div>

      <div class="profile-container">
        <div class="profile-header">
          <img src="{% if owner.profile_image %}{{ owner.profile_image.url }}{% else %}{% static 'users/images/default_profile.png' %}{% endif %}" alt="프로필 사진" class="profile-image">

          <div class="user-info">
            <h3>{{ owner.username }}</h3>
            <p class="age_gender">{{ owner.age }}세&nbsp;&nbsp;{{ owner.get_gender_display }}</p>

            <!-- 거주형태 이모지 + 텍스트 -->
            <p class="living_type">
              <span class="living-type-emoji"
                    data-living="{% if owner.living_type_other %}{{ owner.living_type_other }}{% else %}{{ owner.get_living_type_display }}{% endif %}">
              </span>
              {% if owner.living_type_other %}
                {{ owner.living_type_other }}
              {% else %}
                {{ owner.get_living_type_display }}
              {% endif %}
            </p>

            <!-- 인증 여부-->
            <div class="verification">
              {% if owner_is_id_card_uploaded %}
                <span class="verified">
                  <img src="{% static 'users/images/verified_mark.png' %}" alt="" class="verified_mark"> 신분증 인증 완료
                </span>
              {% else %}
                <span class="unverified">⚠️   신분증 미인증</span>
              {% endif %}

              {% if is_land_register_verified %}
                <span class="verified">
                  <img src="{% static 'users/images/verified_mark.png' %}" alt="" class="verified_mark"> 등기부등본 인증 완료
                </span>
              {% else %}
                <span class="unverified">⚠️   등기부등본 미인증</span>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="line1"></div>

        <!-- 매칭 결과 -->
        <div class="matching-result">
          <h4>성향 매칭 분석 결과</h4>
          <p class="matching-text">{{ matching_text }}</p>
          <p class="explanation">{{ explanation }}</p>

          <!-- 매칭 점수 바 -->
          <div class="score-bar" aria-label="매칭 점수{{ matching_score }}점" data-score="{{ matching_score|default:0 }}">
            <div class="score-fill"></div>
          </div>
          
          <!-- 하트 이미지 -->
          <img src="{% static 'users/images/heart.svg' %}" alt="" class="heart">

          <!-- 점수 -->
          <img src="{% static 'users/images/score.png' %}" alt="" class="score">
          <div class="score-text">{{ matching_score }}점</div>

          <!-- 해시태그 -->
          <div class="hashtags">
            {% for tag in hashtags %}
              <span>#{{ tag }}</span>
            {% endfor %}
          </div>
        </div>

        <div class="line2"></div>
        
        <h4 class="trait-title">각자의 성향</h4>

        <div class="traits-section">

          <!-- 활동 시간대 -->
          <div class="trait-item">
            <p class="trait-label">활동 시간대</p>
            <div class="trait-values">
              <div class="card {% if owner.preferred_time == youth_user.preferred_time %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.preferred_time %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.preferred_time == youth_user.preferred_time %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.preferred_time %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 대화 빈도 -->
          <div class="trait-item">
            <div class="trait-label">대화 빈도</div>
            <div class="trait-values">
              <div class="card {% if owner.conversation_style == youth_user.conversation_style %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.conversation_style %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.conversation_style == youth_user.conversation_style %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.conversation_style %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 생활 공간 중요 포인트 -->
          <div class="trait-item ip-item">
            <div class="trait-label">생활 공간 중요 포인트</div>

            {% with owner_list=owner_parts.important_points youth_list=youth_parts.important_points %}
            <div class="trait-values ip-values">
              {# 1행: 첫 번째 선택 #}
              {% with o0=owner_list.0 y0=youth_list.0 %}
                <div class="card {% if o0 %}{% for y in youth_list %}{% if y.label == o0.label %}card-value-matched{% endif %}{% endfor %}{% endif %}">
                  <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                  {% if o0 %}
                    <p class="trait-emoji">{{ o0.emoji }}</p>
                    <p class="trait-label-text">{{ o0.label }}</p>
                  {% else %}
                    <p class="trait-emoji"> </p>
                    <p class="trait-label-text">선택 없음</p>
                  {% endif %}
                </div>

                <div class="card {% if y0 %}{% for o in owner_list %}{% if o.label == y0.label %}card-value-matched{% endif %}{% endfor %}{% endif %}">
                  <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                  {% if y0 %}
                    <p class="trait-emoji">{{ y0.emoji }}</p>
                    <p class="trait-label-text">{{ y0.label }}</p>
                  {% else %}
                    <p class="trait-emoji"> </p>
                    <p class="trait-label-text">선택 없음</p>
                  {% endif %}
                </div>
              {% endwith %}

              {# 2행: 두 번째 선택 (없으면 공석) #}
              {% with o1=owner_list.1 y1=youth_list.1 %}
                <div class="card {% if o1 %}{% for y in youth_list %}{% if y.label == o1.label %}card-value-matched{% endif %}{% endfor %}{% endif %}">
                  <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                  {% if o1 %}
                    <p class="trait-emoji">{{ o1.emoji }}</p>
                    <p class="trait-label-text">{{ o1.label }}</p>
                  {% else %}
                    <p class="trait-emoji"> </p>
                    <p class="trait-label-text">선택없음</p>
                  {% endif %}
                </div>

                <div class="card {% if y1 %}{% for o in owner_list %}{% if o.label == y1.label %}card-value-matched{% endif %}{% endfor %}{% endif %}">
                  <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                  {% if y1 %}
                    <p class="trait-emoji">{{ y1.emoji }}</p>
                    <p class="trait-label-text">{{ y1.label }}</p>
                  {% else %}
                    <p class="trait-emoji"> </p>
                    <p class="trait-label-text">선택없음</p>
                  {% endif %}
                </div>
              {% endwith %}
            </div>
            {% endwith %}
          </div>

          <!-- 소음 허용도 -->
          <div class="trait-item">
            <div class="trait-label">소음 허용도</div>
            <div class="trait-values">
              <div class="card {% if owner.noise_level == youth_user.noise_level %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.noise_level %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.noise_level == youth_user.noise_level %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.noise_level %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 식사 여부 -->
          <div class="trait-item">
            <div class="trait-label">식사 여부</div>
            <div class="trait-values">
              <div class="card {% if owner.meal_preference == youth_user.meal_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.meal_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.meal_preference == youth_user.meal_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.meal_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 공용공간 사용 -->
          <div class="trait-item">
            <div class="trait-label">공용공간 사용</div>
            <div class="trait-values">
              <div class="card {% if owner.space_sharing_preference == youth_user.space_sharing_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.space_sharing_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.space_sharing_preference == youth_user.space_sharing_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.space_sharing_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 반려동물 여부 -->
          <div class="trait-item">
            <div class="trait-label">반려동물 여부</div>
            <div class="trait-values">
              <div class="card {% if owner.pet_preference == youth_user.pet_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.pet_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.pet_preference == youth_user.pet_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.pet_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <!-- 주말 패턴 -->
          <div class="trait-item">
            <div class="trait-label">주요 생활 패턴</div>
            <div class="trait-values">
              <div class="card {% if owner.weekend_preference == youth_user.weekend_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ owner.username }}(시니어)</p>
                {% with t=owner_parts.weekend_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}
              </div>
              <div class="card {% if owner.weekend_preference == youth_user.weekend_preference %}card-value-matched{% endif %}">
                <p class="trait-user-name">{{ youth_user.username }}(나)</p>
                {% if youth_parts %}{% with t=youth_parts.weekend_preference %}
                  <p class="trait-emoji">{{ t.emoji }}</p>
                  <p class="trait-label-text">{{ t.label }}</p>
                {% endwith %}{% endif %}
              </div>
            </div>
          </div>

          <div class="trait-item"></div>

        </div>
      </div>

      <div class="footer">
        이따 main merge하고 방 상세 페이지에 있는 버튼 갖다 쓰기.
      </div>

    </div>
  </div>

  <script src="{% static 'users/js/senior_profile.js' %}?v=8"></script>

</body>
</html>
