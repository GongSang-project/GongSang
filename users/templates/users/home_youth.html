{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=375, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>청년 홈</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" />
  <style>
    :root{
      --app-w:375px;
      --bg:#f3f3f3;
      --white:#ffffff;
      --line:#e8e8e8;
      --text:#121212;
      --muted:#959595;
      --orange:#f26430;
      --peach:#ffebd9;
      --shadow:0 0 10px #0000001a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:Pretendard,-apple-system,system-ui,Segoe UI,Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif;
    }
    a{color:inherit; text-decoration:none}

    .app{width:var(--app-w); min-height:812px; margin:0 auto; background:var(--bg); position:relative; padding-bottom:88px;}

    /* ===== 상단 화이트 프레임 ===== */
    .topframe{
      background:var(--white);
      border-radius:0 0 12px 12px;
      box-shadow:var(--shadow);
      padding:0 16px 16px; 
    }
    .brandbar{display:flex; align-items:baseline; gap:10px; padding:14px 0 6px;}
    .brand-ko{font-weight:400; font-size:14px; color:var(--orange)}
    .brand-en{font-weight:800; font-size:24px; color:var(--orange); letter-spacing:.2px}
    .brand-search{margin-left:auto; width:56%;}

    /* 검색 필드 */
    .search-wrap{position:relative; margin:8px 0 10px;}
    .brand-search .search-wrap{margin:0;} 
    .search-input{
      width:100%; padding:12px 14px 12px 42px; border:1px solid var(--line); border-radius:999px; background:#fff;
      font-size:14px; color:#333;
      background-image:url('data:image/svg+xml,%3Csvg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Ccircle cx="11" cy="11" r="7" stroke="%23959595" stroke-width="2"/%3E%3Cpath d="M20 20L16.65 16.65" stroke="%23959595" stroke-width="2" stroke-linecap="round"/%3E%3C/svg%3E');
      background-repeat:no-repeat; background-position:12px 50%;
    }
    .ac-list{
      position:absolute; top:110%; left:0; right:0; background:#fff; border:1px solid var(--line);
      border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.06);
      list-style:none; margin:6px 0 0; padding:6px 0; display:none; z-index:10; max-height:260px; overflow:auto;
    }
    .ac-list li{padding:10px 12px; cursor:pointer}
    .ac-list li:hover{background:#f7f7f7}

    /* 타이틀 */
    .tiny{font-size:16px; margin:10px 2px 2px}
    .sec-title{display:flex; align-items:center; gap:8px; margin:0 2px 10px}
    .sec-title b{font-size:16px}
    .info-dot{display:inline-flex; width:18px; height:18px; border-radius:50%; border:1px solid #d2d2d2; align-items:center; justify-content:center; font-size:12px; color:#777}
    .sec-title .spacer{margin-left:auto}
    .more{font-weight:800; color:#666; margin-left:6px; font-size:18px}

    /* 가로 스크롤 카드 */
    .hscroll{display:flex; gap:12px; overflow-x:auto; padding:6px 0 14px}
    .card{
      flex:0 0 64%; max-width:64%;
      background:#fff; border:1px solid var(--line); border-radius:14px; overflow:hidden;
    }
    @media(min-width:430px){ .card{flex-basis:60%; max-width:60%} }

    .thumb{width:100%; aspect-ratio:4/3; object-fit:cover; display:block; background:#d1d1d1}
    .like{
      position:absolute; right:10px; top:10px; width:28px; height:28px; display:grid; place-items:center;
      background:rgba(255,255,255,.95); border-radius:50%; border:1px solid #eee; cursor:pointer;
    }
    .like svg{width:16px; height:16px}
    .like path{stroke:#999; stroke-width:1.5; fill:none}
    .like.active path{fill:#ff6a6a; stroke:#ff6a6a}

    .meta{padding:10px 12px}
    .price{font-weight:800}
    .type{color:var(--muted); font-size:13px; margin:4px 0}
    .tags{display:flex; gap:6px; flex-wrap:wrap}
    .tag{font-size:11px; border:1px solid #FFE0B2; background:#FFF7ED; color:#B45309; border-radius:999px; padding:4px 8px}
    .owner{margin-top:6px; color:#555; font-size:13px}

    /* ===== 카테고리 모자이크 ===== */
    .cats{padding:12px 16px 0}
    .grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:12px; /* 상단 두 타일 동일 너비 */
      grid-auto-rows: 112px; /* 기본 높이 */
    }
    .cat{background:#fff; border:1px solid var(--line); border-radius:16px; padding:16px; position:relative; font-weight:800; box-shadow:var(--shadow)}
    .cat svg{position:absolute; right:16px; bottom:12px; width:32px; height:32px; opacity:.6}
    .cat.apt{height:112px}
    .cat.villa{height:112px}
    .cat.off{height:85px}    /* 오피스텔 작게 */
    .cat.house{height:85px}  /* 주택 작게 */

    /* ===== 하단 탭 ===== */
    .tabbar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:0; width:var(--app-w); height:82px; background:#fff; border-top:1px solid #d0d0d0;
      box-shadow:0 -3.5px 7px rgba(0,0,0,.05);
    }
    .tabbar .wrap{display:flex; justify-content:space-around; padding-top:10px}
    .tab{display:flex; flex-direction:column; align-items:center; gap:4px; color:#959595; font-size:12px}
    .tab svg{width:20px; height:20px}
    .tab.active{color:var(--orange)}
    .home-indicator{position:absolute; left:50%; transform:translateX(-50%); bottom:10px; width:134px; height:5px; border-radius:100px; background:#000}

    /* 유틸 */
    .rel{position:relative}
  </style>
</head>
<body>
<div class="app">

  <!-- ===== 상단 화이트 프레임 ===== -->
  <div class="topframe">
    <!-- 로고 -->
    <div class="brandbar">
      <div class="brand-en">DOOYU</div>
      <div class="brand-ko">두유</div>
      <div class="brand-search">
        <form id="search-form" method="get" action="{% url 'room:room_list_page' %}" class="search-wrap" autocomplete="off">
          <input id="region-search" name="region" type="text" class="search-input" placeholder="지역을 검색해보세요" />
          <ul id="ac-list" class="ac-list"></ul>
        </form>
      </div>
    </div>

    <!-- 섹션 타이틀 -->
    <div class="tiny">✨ 나와 잘 맞는</div>
    <div class="sec-title">
      <b>매칭 점수 높은 방 TOP3</b>
      <a class="more" href="{% url 'users:all_rooms_youth' %}">›</a>
      <span class="spacer"></span>
      <span class="info-dot">i</span>
    </div>

    <!-- TOP3 카드 -->
    <div class="hscroll">
      {% if recommended_rooms %}
        {% for room in recommended_rooms|slice:":3" %}
          <div class="card">
            <a href="{% url 'room:room_detail' room.id %}">
              <div class="rel">
                {% with p=room.photos.all %}
                  {% if p|length %}
                    <img class="thumb" src="{{ p.0.image.url }}" alt="">
                  {% else %}
                    <div class="thumb"></div>
                  {% endif %}
                {% endwith %}
                <button class="like" type="button" aria-label="관심">
                  <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-.99-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.77-8.84a5.5 5.5 0 0 0 .07-7.78Z"/></svg>
                </button>
              </div>
              <div class="meta">
                <div class="price">월세 {{ room.rent_fee|default:"-" }}/{{ room.deposit|default:"-" }}</div>
                <div class="type">{{ room.property_type|default:"아파트" }}</div>
                <div class="tags">
                  {% if room.hashtags %}
                    {% for t in room.hashtags %}<span class="tag">#{{ t }}</span>{% endfor %}
                  {% endif %}
                </div>
                <div class="owner">
                  {% if room.owner.gender == 'M' %}👨 남성{% elif room.owner.gender == 'F' %}👩 여성{% else %}🙂 성별 정보 없음{% endif %}
                  {% if room.owner_living_status %} · {{ room.owner_living_status }}{% endif %}
                </div>
              </div>
            </a>
          </div>
        {% endfor %}
      {% else %}
        <p style="margin:6px 2px 10px; color:#666;">관심 지역에 해당하는 방이 없거나, AI 추천을 받을 수 없습니다.</p>
      {% endif %}
    </div>
  </div>

  <!-- ===== 카테고리 ===== -->
  <div class="cats">
    <div class="grid">
      <a class="cat apt"   href="{% url 'room:room_list_page' %}?property_type=아파트">아파트
        <svg viewBox="0 0 24 24" fill="none" stroke="#bdbdbd" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="8" width="18" height="12" rx="2"/><path d="M7 12h2M7 16h2M11 12h2M11 16h2M15 12h2M15 16h2M9 8V4h6v4"/>
        </svg>
      </a>
      <a class="cat villa" href="{% url 'room:room_list_page' %}?property_type=빌라">빌라
        <svg viewBox="0 0 24 24" fill="none" stroke="#bdbdbd" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12l9-8 9 8"/><path d="M5 10v10h14V10"/><path d="M9 20v-6h6v6"/>
        </svg>
      </a>
      <a class="cat off"   href="{% url 'room:room_list_page' %}?property_type=오피스텔">오피스텔
        <svg viewBox="0 0 24 24" fill="none" stroke="#bdbdbd" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="10" height="18" rx="1"/><rect x="15" y="7" width="6" height="14" rx="1"/><path d="M7 7h2M7 11h2M7 15h2M18 11h2M18 15h2"/>
        </svg>
      </a>
      <a class="cat house" href="{% url 'room:room_list_page' %}?property_type=주택">주택
        <svg viewBox="0 0 24 24" fill="none" stroke="#bdbdbd" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 12l9-8 9 8"/><path d="M5 10v10h14V10"/><path d="M9 20v-6h6v6"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- ===== 하단 탭 ===== -->
  <nav class="tabbar" aria-label="하단 탭">
    <div class="wrap">
      <a class="tab" href="{% url 'room:room_list_page' %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="7"/><path d="M20 20l-3.5-3.5"/>
        </svg>
        <span>검색</span>
      </a>
      <a class="tab active" href="#">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10.5 2.5l-8 7A2 2 0 0 0 2 11h1v9a2 2 0 0 0 2 2h5v-7h4v7h5a2 2 0 0 0 2-2v-9h1a2 2 0 0 0-1.5-3.5l-8-7Z"/></svg>
        <span>홈</span>
      </a>
      <a class="tab" href="{% url 'users:youth_info' %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/>
        </svg>
        <span>마이페이지</span>
      </a>
    </div>
  </nav>
</div>

<!-- ===== JS: 자동완성 & 하트 ===== -->
<script>
  // 하트 토글 (프론트 전용)
  document.querySelectorAll('.like').forEach(btn=>{
    btn.addEventListener('click', e=>{ e.preventDefault(); e.stopPropagation(); btn.classList.toggle('active'); });
  });

  // 자동완성
  const form = document.getElementById('search-form');
  const input = document.getElementById('region-search');
  const list  = document.getElementById('ac-list');
  const endpoint = "{% url 'users:autocomplete_region' %}";

  function debounce(fn, delay=220){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), delay); }; }
  function render(items){
    list.innerHTML='';
    if(!items || !items.length){ list.style.display='block'; const li=document.createElement('li'); li.textContent='검색 결과가 없습니다'; li.style.color='#888'; list.appendChild(li); return; }
    items.forEach(name=>{ const li=document.createElement('li'); li.textContent=name;
      li.addEventListener('click',()=>{ input.value=name; list.style.display='none'; form.submit(); });
      list.appendChild(li);
    });
    list.style.display='block';
  }
  const fetchS = debounce(async(q)=>{
    const query=q.trim(); if(!query){ list.style.display='none'; return; }
    try{
      const res = await fetch(`${endpoint}?query=${encodeURIComponent(query)}`, {headers:{'Accept':'application/json'}});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json(); render(data.results||[]);
    }catch(e){ console.error(e); list.style.display='none'; }
  });
  input.addEventListener('input', e=> fetchS(e.target.value));
  input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); list.style.display='none'; form.submit(); }});
  document.addEventListener('click', e=>{ const box=document.querySelector('.search-wrap'); if(box && !box.contains(e.target)) list.style.display='none'; });
</script>
</body>
</html>
