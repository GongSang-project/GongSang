{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>청년 마이페이지</title>
  <style>
    :root{
      --primary:#F26430;
      --secondary:#FFEBD9;
      --text:#121212;
      --muted:#6F6F6F;
      --gnb-inactive:#959595;
      --border:#E9E9E9;
      --bg:#fff;
      --radius:15px;
      --page-max:375px;
      --gnb-height:84px; /* 하단 GNB 총 높이(아이콘+패딩+인디케이터 포함) 추정치 */
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#fff;color:var(--text);font-family: Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", "맑은 고딕", "Malgun Gothic", sans-serif;}
    a{color:inherit;text-decoration:none}
    button{font:inherit}

    /* page wrap */
    .page{max-width:var(--page-max);min-height:100dvh;margin:0 auto;position:relative;
      padding-bottom:calc(var(--gnb-height) + 64px + 16px); /* GNB + 로그아웃(64) + 여유 */
      background:#fff}

    /* top gradient header */
    .top{
      position:relative;
      padding:64px 16px 28px;
      background:linear-gradient(180deg,#fff 0%, var(--secondary) 90%);
      border-bottom-left-radius:26px;border-bottom-right-radius:26px;
      box-shadow:inset 0 0 2.7px var(--secondary);
    }
    .brand{display:flex;gap:6px;align-items:center;position:absolute;left:16px;top:18px}
    .brand .ko{font-weight:800;font-family:"Tmoney RoundWind", Pretendard, sans-serif;font-size:24px;line-height:15px;color:var(--primary)}
    .brand .sub{font-family:"Tmoney RoundWind", Pretendard, sans-serif;font-size:14px;line-height:15px;color:var(--primary)}

    /* profile */
    .profile{
      display:grid;grid-template-columns:74px 1fr auto;gap:12px;align-items:center;
    }
    .avatar{
      width:74px;height:74px;border-radius:50%;background:var(--gnb-inactive);overflow:hidden;display:flex;align-items:center;justify-content:center;color:#fff;font-size:34px;
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
    .p-name{font-weight:600;font-size:16px;margin:0 0 4px}
    .p-meta{margin:0;color:var(--muted);font-size:12px;line-height:1.35}
    .edit-link{display:flex;align-items:center;gap:6px;color:#7F7F7F;font-size:11px}
    .edit-link svg{width:11px;height:13px}

    /* section: preferences */
    .sec-title{
      display:flex;align-items:center;justify-content:space-between;margin:18px 0 10px;
    }
    .sec-title h3{margin:0;font-size:14px;font-weight:400}
    .card{background:#fff;border-radius:var(--radius);box-shadow:0 0 3.66px rgba(0,0,0,.10);padding:16px}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      background:var(--primary);color:#fff;border-radius:10px;padding:10px 20px;font-size:14px;font-weight:600;line-height:16px;display:inline-flex;align-items:center;justify-content:center
    }

    /* list buttons */
    .list{margin-top:18px}
    .list-item{
      position:relative;margin:11px 16px;background:var(--secondary);border-radius:12px;height:42px;
      display:flex;align-items:center;padding:0 15px;color:var(--primary);font-weight:600;font-size:14px;
    }
    .list-item svg{position:absolute;right:15px;width:8px;height:13px}
    
    /* logout row (redesigned like the screenshot) */
    .frame{
      position:fixed;left:50%;transform:translateX(-50%);
      bottom:calc(var(--gnb-height) + -10px); /* GNB와 겹치지 않도록 가변 간격 */
      width:100%;max-width:var(--page-max);height:64px;margin:0 auto;
      background:#fff;z-index:4;
      border-top:1px solid var(--border)
    }
    .frame .view{position:relative;width:325px;height:42px;margin:11px 25px;display:flex;align-items:center}
    .text-logout{
      display:flex;width:100%;height:100%;
      align-items:center; /* 수직 중앙 정렬 */
      padding-left:15px; /* 좌측 15px */
      text-align:left;
      font-family:Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", "맑은 고딕", "Malgun Gothic", sans-serif;
      font-weight:400;color:#959595;font-size:14px;letter-spacing:-0.07px;white-space:nowrap;
      background:none;border:0;cursor:pointer
    }

    /* GNB footer */
    .gnb{position:fixed;left:50%;transform:translateX(-50%);bottom:0;width:100%;max-width:var(--page-max);
      background:#fff;border-top:0.65px solid rgba(0,0,0,.12);box-shadow:0 -3.73px 7.46px rgba(0,0,0,.05);z-index:5;
      padding-bottom:env(safe-area-inset-bottom)}
    .gnb__inner{display:flex;justify-content:space-around;align-items:center;padding:10px 12px 16px}
    .gnb__link{display:flex;flex-direction:column;align-items:center;gap:4px;text-decoration:none;color:var(--gnb-inactive);font-size:12px}
    .gnb__link .icon{width:24px;height:24px;display:block}
    .gnb__link.is-active{color:var(--primary)}

    /* Logout confirm modal (Figma spec) */
    .modal-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:16px;background:rgba(0,0,0,.45);z-index:10}
    .modal-overlay.is-open{display:flex}
    .alert{display:inline-flex;flex-direction:column;align-items:flex-start;gap:10px;padding:16px;position:relative;background-color:#fff;border-radius:12px}
    .alert .contents{display:flex;flex-direction:column;width:256px;align-items:center;gap:22px;position:relative;flex:0 0 auto}
    .alert .warning{display:flex;flex-direction:column;align-items:center;gap:8px;width:100%;position:relative;align-self:stretch}
    .alert .warning-msg{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;position:relative;align-self:stretch}
    .alert .text-wrapper{position:relative;align-self:stretch;margin-top:-1px;font-family:"Pretendard-Bold", Pretendard, sans-serif;font-weight:700;color:#222229;font-size:20px;text-align:center;letter-spacing:-0.10px;line-height:24px}
    .alert .warning-message{font-family:"Pretendard-Regular", Pretendard, sans-serif;font-weight:400;color:#4d4d5c;font-size:16px;text-align:center;letter-spacing:-0.08px;line-height:20px;position:relative;align-self:stretch}
    .alert .buttons{display:flex;align-items:center;gap:12px;position:relative;align-self:stretch;width:100%}
    .alert .button-s{display:flex;width:122px;height:40px;align-items:center;justify-content:center;gap:10px;padding:5px 35px;background-color:#e8e8e8;border-radius:8px}
    .alert .button{all:unset;box-sizing:border-box;position:relative;width:fit-content;font-family:"Pretendard-Bold", Pretendard, sans-serif;font-weight:700;color:#515151;font-size:18px;letter-spacing:-0.09px;line-height:15px;white-space:nowrap}
    .alert .button-wrapper{display:flex;width:122px;height:40px;align-items:center;justify-content:center;gap:10px;padding:5px 35px;background-color:#f26430;border-radius:8px}
    .alert .div{all:unset;box-sizing:border-box;position:relative;width:fit-content;font-family:"Pretendard-Bold", Pretendard, sans-serif;font-weight:700;color:#fff;font-size:18px;letter-spacing:-0.09px;line-height:15px;white-space:nowrap}
  </style>
</head>
<body>
  <main class="page">
    <!-- Top / Profile -->
    <section class="top">
      <div class="brand">
        <span class="ko">DOOYU</span><span class="sub">두유</span>
      </div>

      <div class="profile">
        <div class="avatar">
          {% if user.profile_image %}
            <img src="{{ user.profile_image.url }}" alt="프로필 사진">
          {% else %}
            <!-- simple placeholder -->
            <svg width="38" height="38" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="8" r="4.5" fill="#fff"/>
              <path d="M3 21a9 9 0 0 1 18 0" fill="#fff"/>
            </svg>
          {% endif %}
        </div>

        <div>
          <h2 class="p-name">{{ user.username }} 님</h2>
          <p class="p-meta">{{ user.age }}세 / {{ user.get_gender_display }} / {{ user.phone_number|default:"전화번호 미입력" }}</p>
          <p class="p-meta">관심 지역 : {{ user.interested_province }} {{ user.interested_city }} {{ user.interested_district }}</p>
        </div>

        <a href="{% url 'users:user_info' %}" class="edit-link">
          수정하기
          <svg viewBox="0 0 11 13" xmlns="http://www.w3.org/2000/svg"><path d="M10.82 3.195c.238-.26.238-.693 0-.94L9.391.695a.67.67 0 0 0-.862 0L7.406 1.915l2.291 2.5M0 10v2.5h2.291l6.758-7.379-2.291-2.5L0 10Z" fill="#7F7F7F"/></svg>
        </a>
      </div>

      <div class="sec-title">
        <h3>선택한 성향</h3>
        <a href="{% url 'users:survey_wizard_start' %}" class="edit-link">
          수정하기
          <svg viewBox="0 0 11 13" xmlns="http://www.w3.org/2000/svg"><path d="M10.82 3.195c.238-.26.238-.693 0-.94L9.391.695a.67.67 0 0 0-.862 0L7.406 1.915l2.291 2.5M0 10v2.5h2.291l6.758-7.379-2.291-2.5L0 10Z" fill="#7F7F7F"/></svg>
        </a>
      </div>

      <div class="card">
        <div class="chips">
          {% if user_preferences and user_preferences|length > 0 %}
            {% for preference in user_preferences %}
              <span class="chip">{{ preference }}</span>
            {% endfor %}
          {% else %}
            <span style="color:#7F7F7F;font-size:13px;">선택한 성향이 없습니다.</span>
          {% endif %}
        </div>
      </div>
    </section>

    <!-- Buttons -->
    <section class="list">
      <a class="list-item" href="{% url 'review:review_list_youth' %}">
        후기 작성
        <svg viewBox="0 0 8 13" xmlns="http://www.w3.org/2000/svg"><path d="M1.155 1.5 6.84 6.711 1.155 11.923" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>

      <a class="list-item" href="{% url 'users:my_reviews' %}">
        나에 대한 후기
        <svg viewBox="0 0 8 13" xmlns="http://www.w3.org/2000/svg"><path d="M1.155 1.5 6.84 6.711 1.155 11.923" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>

       <div class="frame">
         <div class="view">
           <form id="logoutForm" action="{% url 'users:user_logout' %}" method="post">
             {% csrf_token %}
             <button type="button" id="openLogoutModal" class="text-logout">로그아웃</button>
           </form>
         </div>
       </div>
     </section>
  </main>

<!-- GNB footer (마이페이지 활성) -->
<nav class="gnb" role="navigation" aria-label="하단 내비게이션">
    <div class="gnb__inner">
      <!-- 검색 -->
      <a href="#" class="gnb__link" aria-label="검색">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="11" cy="11" r="7.75" stroke="currentColor" stroke-width="1.7"/>
          <path d="M16.65 16.65L21.5 21.5" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
        <span>검색</span>
      </a>
  
      <!-- 홈 -->
      <a href="#" class="gnb__link" aria-label="홈">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 10.5L12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1z"
                stroke="currentColor" stroke-width="1.7" stroke-linejoin="round" stroke-linecap="round"/>
        </svg>
        <span>홈</span>
      </a>
  
      <!-- 마이페이지(활성) — URL 역참조 제거 -->
      <a href="#" class="gnb__link is-active" aria-current="page" aria-label="마이페이지">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.7"/>
          <path d="M4 21a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
        <span>마이페이지</span>
      </a>
    </div>
  </nav>
  
  <!-- Logout confirm modal -->
  <div id="logoutModal" class="modal-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="alert" role="document">
      <div class="contents">
        <div class="warning">
          <div class="warning-msg">
            <div class="text-wrapper">로그아웃</div>
            <div class="warning-message">로그아웃 하시겠습니까?</div>
          </div>
        </div>
        <div class="buttons">
          <div class="button-s"><button type="button" class="button" id="cancelLogoutBtn">취소</button></div>
          <div class="button-wrapper"><button type="submit" form="logoutForm" class="div" id="confirmLogoutBtn">확인</button></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const openBtn = document.getElementById('openLogoutModal');
      const modal = document.getElementById('logoutModal');
      const cancelBtn = document.getElementById('cancelLogoutBtn');

      function open(){ modal.classList.add('is-open'); modal.setAttribute('aria-hidden','false'); }
      function close(){ modal.classList.remove('is-open'); modal.setAttribute('aria-hidden','true'); }

      openBtn && openBtn.addEventListener('click', function(e){ e.preventDefault(); open(); });
      cancelBtn && cancelBtn.addEventListener('click', close);
      modal && modal.addEventListener('click', function(e){ if(e.target === modal) close(); });
      document.addEventListener('keydown', function(e){ if(e.key === 'Escape') close(); });
    })();
  </script>
  
</body>
</html>
