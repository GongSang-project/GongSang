{% load custom_filters %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ youth_user.username }}님의 프로필</title>
</head>
<body>
    <div class="container">
        <div class="profile-header">
            <img src="{% if youth_user.profile_image %}{{ youth_user.profile_image.url }}{% else %}/static/images/default_profile.png{% endif %}" alt="프로필 사진" class="profile-image">
            <div class="user-info">
                <h3>{{ youth_user.username }}</h3>
                <p>{{ youth_user.age }}세 {{ youth_user.get_gender_display }}</p>
                <div class="verification">
                    {% if is_id_card_uploaded %}
                        <span class="verified">✔ 신분증 인증 완료</span>
                    {% else %}
                        <span class="unverified">⚠️ 신분증 미인증</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="matching-result">
            <h4>성향 매칭 분석 결과</h4>
            <p class="matching-text">{{ matching_text }}</p>
            <div class="score-bar">
                <div class="score-fill"></div>
                <div class="score-text">{{ matching_score }}점</div>
            </div>
            <p class="explanation">{{ explanation }}</p>
            <div class="hashtags">
                {% for tag in hashtags %}
                    <span>#{{ tag }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="reviews-section">
            <h4>후기 ★<i class="fa-solid fa-star"></i> {{ average_rating|floatformat:"1" }} ({{ review_count }}개)</h4>
            <div class="review-summary">
                <h5>AI 후기 요약 분석 <i class="fa-solid fa-robot"></i></h5>
                <p>{{ ai_summary }}</p>
            </div>

            <div class="review-hashtags">
                <div class="review-hashtags-item">
                    <p>개선되었으면 좋았을 점</p>
                    <div class="hashtags">
                        {% for tag in bad_hashtags %}
                            <span>{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="review-hashtags-item">
                    <p>좋았던 점</p>
                    <div class="hashtags">
                        {% for tag in good_hashtags %}
                            <span>{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="individual-reviews">
                {% for review in reviews|slice:":2" %}
                <div class="review-item">
                    <div class="review-meta">
                        <p class="reviewer-name">
                            {% if review.is_anonymous %}
                                익명{{ forloop.counter }}
                            {% else %}
                                {{ review.author.username }}
                            {% endif %}
                        </p>
                        <p class="residence-period">{{ review.get_lived_period_display }}</p>
                    </div>
                    <div class="review-rating">
                        <span class="star-rating">
                            {% if review.satisfaction == 'VERY_SATISFIED' %}★★★★★
                            {% elif review.satisfaction == 'SATISFIED' %}★★★★☆
                            {% elif review.satisfaction == 'NORMAL' %}★★★☆☆
                            {% elif review.satisfaction == 'DISSATISFIED' %}★★☆☆☆
                            {% else %}★☆☆☆☆
                            {% endif %}
                        </span>
                        <span class="review-date">{{ review.created_at|date:"Y년 m월 d일" }} 작성</span>
                    </div>
                    <p class="review-text">{{ review.good_points }}</p>
                </div>
                {% empty %}
                <p>아직 등록된 후기가 없습니다.</p>
                {% endfor %}
            </div>

            {% if review_count > 0 %}
            <div class="view-all-reviews">
                <a href="{% url 'users:all_reviews_for_youth' youth_user.id %}">
                    <button>후기 모두 보기</button>
                </a>
            </div>
            {% endif %}

        <div class="traits-section">
          <h4>각자의 성향</h4>
          <div class="trait-item">
              <div class="trait-label">활동 시간대</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.preferred_time == youth_user.preferred_time %}trait-value-matched{% endif %}">
                          {{ youth_user.get_preferred_time_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.preferred_time == youth_user.preferred_time %}trait-value-matched{% endif %}">
                          {{ senior_user.get_preferred_time_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
            <div class="trait-label">대화 빈도</div>
            <div class="trait-values">
                <div class="trait-user">
                    <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                    <p class="trait-value {% if youth_user.conversation_style == senior_user.conversation_style %}trait-value-matched{% endif %}">
                        {{ youth_user.get_conversation_style_display }}
                    </p>
                </div>
                <div class="trait-user">
                    <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                    <p class="trait-value {% if youth_user.conversation_style == senior_user.conversation_style %}trait-value-matched{% endif %}">
                        {{ senior_user.get_conversation_style_display }}
                    </p>
                </div>
            </div>
        </div>
          <div class="trait-item">
              <div class="trait-label">생활공간 중요 포인트</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value">
                          {{ youth_user.important_points|get_important_points_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value">
                          {{ senior_user.important_points|get_important_points_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">소음 허용도</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.noise_level == youth_user.noise_level %}trait-value-matched{% endif %}">
                          {{ youth_user.get_noise_level_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.noise_level == youth_user.noise_level %}trait-value-matched{% endif %}">
                          {{ senior_user.get_noise_level_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">식사 여부</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.meal_preference == youth_user.meal_preference %}trait-value-matched{% endif %}">
                          {{ youth_user.get_meal_preference_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.meal_preference == youth_user.meal_preference %}trait-value-matched{% endif %}">
                          {{ senior_user.get_meal_preference_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">공용공간 사용</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.space_sharing_preference == youth_user.space_sharing_preference %}trait-value-matched{% endif %}">
                          {{ youth_user.get_space_sharing_preference_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.space_sharing_preference == youth_user.space_sharing_preference %}trait-value-matched{% endif %}">
                          {{ senior_user.get_space_sharing_preference_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">반려동물 여부</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.pet_preference == youth_user.pet_preference %}trait-value-matched{% endif %}">
                          {{ youth_user.get_pet_preference_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.pet_preference == youth_user.pet_preference %}trait-value-matched{% endif %}">
                          {{ senior_user.get_pet_preference_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">흡연 여부</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.smoking_preference == youth_user.smoking_preference %}trait-value-matched{% endif %}">
                          {{ youth_user.get_smoking_preference_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.smoking_preference == youth_user.smoking_preference %}trait-value-matched{% endif %}">
                          {{ senior_user.get_smoking_preference_display }}
                      </p>
                  </div>
              </div>
          </div>
          <div class="trait-item">
              <div class="trait-label">주요 생활 패턴</div>
              <div class="trait-values">
                  <div class="trait-user">
                      <p class="trait-user-name">{{ youth_user.username }}(청년)</p>
                      <p class="trait-value {% if senior_user.weekend_preference == youth_user.weekend_preference %}trait-value-matched{% endif %}">
                          {{ youth_user.get_weekend_preference_display }}
                      </p>
                  </div>
                  <div class="trait-user">
                      <p class="trait-user-name">{{ senior_user.username }}(나)</p>
                      <p class="trait-value {% if senior_user.weekend_preference == youth_user.weekend_preference %}trait-value-matched{% endif %}">
                          {{ senior_user.get_weekend_preference_display }}
                      </p>
                  </div>
              </div>
          </div>
      </div>
    </div>
</body>
</html>